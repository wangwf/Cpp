// g++  -Wall -Weffc++ -Wint-to-pointer-cast thread3.C  -fpermissive -lpthread
//
//

#include <iostream>
#include <pthread.h>
#include <stdlib.h>

using namespace std;

#define NUM_THREADS 5


void *wait(void *t)
{
  int i;
  long tid;

  tid = (long) t;

  sleep(1);

  cout<<"Sleeping in thread "<<endl;
  cout<<"Thread with id : "<<tid<<" ...exiting "<<endl;

  //  pthread_exit(NULL);
  pthread_exit(tid*10); // can be used for join
}

int main()
{
  int rc,i;

  pthread_t threads[NUM_THREADS];
  pthread_attr_t attr;
  void *status;

  pthread_attr_init(&attr);
  pthread_attr_setdetachstate(&attr, PTHREAD_CREATE_JOINABLE);

  for(i=0; i<NUM_THREADS; i++){
    cout<<"main() : creating thread, "<<i<<endl;
    rc=pthread_create(&threads[i], NULL, wait, (void*) i );
    if(rc) {
      cout<<"Error: unable to create thread, "<<rc<<endl;
      exit(-1);
    }
  }

  //free attribute and wait for the other threads
  pthread_attr_destroy(&attr);
  for(i =0; i<NUM_THREADS; i++){
    rc = pthread_join(threads[i], &status);
    if (rc){
      cout<<"Error: unable to join, "<<rc<<endl;
      exit(-1);
    }
    cout<<"Main: completed thread_id :"<<i;
    cout<<"  exiting with status :"<<(int)status<<endl;
  }
  cout<<"Main: Program exiting."<<endl;
  pthread_exit(NULL);

}
